[graphical_environment.post.install.mako]
if.not = ["features.essential"]
if.all = ["features.graphical", "features.graphical_environment == 'sway'"]
order_priority = 95
do = [
  {action = 'download', url = 'https://github.com/emersion/mako/releases/download/v1.4.1/mako-1.4.1.tar.gz', to = '/mako-1.4.1.tar.gz'},
  {action = 'sha256sum', from = '/mako-1.4.1.tar.gz', expected = '27ab63264a74389de2119393fe64fd578a4c1d04c8409990ef7cfbb6eb9309bb'},
  {action = 'run', bin = 'tar', args = ['-v', '-xzf', '/mako-1.4.1.tar.gz']},
  {action = 'run', bin = 'rm', args = ['/mako-1.4.1.tar.gz']},
  {action = 'run', bin = 'bash', args = ['-c', 'cd /mako-1.4.1 && meson build']},
  {action = 'run', bin = 'bash', args = ['-c', 'cd /mako-1.4.1 && ninja -C build']},
  {action = 'run', bin = 'cp', args = ['/mako-1.4.1/build/mako', '/usr/local/bin/mako']},
  {action = 'run', bin = 'rm', args = ['-rf', '/mako-1.4.1']},
]

[graphical_environment.post.install.gammastep]
if.not = ["features.essential"]
if.all = ["features.graphical", "features.graphical_environment == 'sway'"]
order_priority = 95
packages = ["intltool"]
do = [
  {action = 'mkdir', dir = '/gammastep-src'},
  {action = 'run', bin = 'git', args = ['clone', 'https://gitlab.com/chinstrap/gammastep', '/gammastep-src/gammastep']},
  {action = 'run', bin = 'git', args = ['-C', '/gammastep-src/gammastep', 'checkout', 'v2.0.5']},
  {action = 'run', bin = 'bash', args = ['-c', 'cd /gammastep-src/gammastep && ./bootstrap']},
  {action = 'run', bin = 'bash', args = ['-c', 'cd /gammastep-src/gammastep && ./configure']},
  {action = 'run', bin = 'make', args = ['-C', '/gammastep-src/gammastep']},
  {action = 'run', bin = 'make', args = ['-C', '/gammastep-src/gammastep', 'install']},
  {action = 'run', bin = 'rm', args = ['-rf', '/gammastep-src']},
]

[graphical_environment.post.install.non-latin-fonts]
if.not = ["features.essential"]
if.all = ["features.graphical"]
order_priority = 94
packages = ["fonts-indic", "fonts-noto", "fonts-noto-cjk"]

[graphical_environment.post.install.nmap-tools]
if.not = ["features.essential"]
if.all = ["features.graphical"]
order_priority = 90
packages = ["nmap", "ncat", "ndiff"]

[graphical_environment.post.install.gui-dev-tools]
if.all = ["features.graphical", "features.SWE"]
order_priority = 85
packages = ["gpick", "glade"]

[graphical_environment.post.install.cad-and-images]
if.all = ["features.graphical"]
if.any = ["features.av", "features.maker"]
order_priority = 80
packages = ["inkscape", "gthumb", "openscad"]

[graphical_environment.post.install.qemu-gui]
if.all = ["features.container_tools"]
order_priority = 80
packages = ["qemu-system-gui"]

[graphical_environment.post.install.wireshark]
if.not = ["features.essential"]
if.all = ["features.graphical"]
order_priority = 75
packages = ["wireshark"]

[graphical_environment.post.install.meld]
if.not = ["features.essential"]
if.all = ["features.graphical", "features.SWE"]
order_priority = 75
packages = ["meld"]

[graphical_environment.post.install.chrome]
if.not = ["features.essential"]
if.all = ["features.graphical"]
order_priority = 50
do = [
  {action = 'download', url = 'https://dl.google.com/linux/linux_signing_key.pub', to = '/chrome-signing-key.pub'},
  {action = 'run', bin = 'apt-key', args = ['add', '/chrome-signing-key.pub']},
  {action = 'mkdir', dir = '/etc/apt/sources.list.d'},
  {action = 'append', to = '/etc/apt/sources.list.d/google-chrome.list', data = "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main\n"},
  {action = 'run', bin = 'rm', args = ['/chrome-signing-key.pub']},
  {action = 'run', bin = 'apt-get', args = ['update']},
  {action = 'run', bin = 'apt-get', args = ['-y', 'install', 'google-chrome-stable']},
]

[graphical_environment.post.install.rawtherapee]
if.all = ["features.graphical", "features.av"]
order_priority = 40
packages = ["rawtherapee"]

[graphical_environment.post.install.kite]
if.all = ["features.graphical", "features.maker"]
order_priority = 40
do = [
  {action = 'download', url = 'https://github.com/twitchyliquid64/kcgen/releases/download/v0.3.0/kite_0.3.0_amd64.deb', to = '/kite_0.3.0_amd64.deb'},
  {action = 'sha256sum', from = '/kite_0.3.0_amd64.deb', expected = '8e533d7399d02c1df80bf02b211d3aeb05f2656f6fb9b3a0cb36e12a05c73201'},
  {action = 'run', bin = 'dpkg', args = ['-i', '/kite_0.3.0_amd64.deb']},
  {action = 'run', bin = 'rm', args = ['/kite_0.3.0_amd64.deb']},
]

[graphical_environment.post.install.kcgen]
if.all = ["features.graphical", "features.maker"]
order_priority = 40
do = [
  {action = 'download', url = 'https://github.com/twitchyliquid64/kcgen/releases/download/v0.3.0/kcgen_0.3.0_amd64.deb', to = '/kcgen_0.3.0_amd64.deb'},
  {action = 'sha256sum', from = '/kcgen_0.3.0_amd64.deb', expected = 'd86c96b3e6c9373a817283804796099eeb8bccacb1c987a7d4f4c101d44fad95'},
  {action = 'run', bin = 'dpkg', args = ['-i', '/kcgen_0.3.0_amd64.deb']},
  {action = 'run', bin = 'rm', args = ['/kcgen_0.3.0_amd64.deb']},
]

[optional.packages.kicad]
if.all = ["features.graphical", "features.maker"]
display_name = "KiCad"
version = "5.x.x"
packages = ["kicad", "kicad-libraries", "kicad-doc-en", "kicad-packages3d"]


[graphical_environment.post.install.atom]
if.all = ["features.graphical", "features.SWE"]
order_priority = 45
do = [
  {action = 'download', url = 'https://packagecloud.io/AtomEditor/atom/gpgkey', to = '/atom-signing-key.pub'},
  {action = 'run', bin = 'apt-key', args = ['add', '/atom-signing-key.pub']},
  {action = 'append', to = '/etc/apt/sources.list', data = "deb [arch=amd64] https://packagecloud.io/AtomEditor/atom/any/ any main\n"},
  {action = 'run', bin = 'rm', args = ['/atom-signing-key.pub']},
  {action = 'run', bin = 'apt-get', args = ['update']},
  {action = 'run', bin = 'apt-get', args = ['-y', 'install', 'atom']},
  {action = 'run', bin = 'runuser', args = ['-l', '{{base.main_user.name}}', '-c', '/usr/bin/apm install file-icons']},
  {action = 'run', bin = 'runuser', args = ['-l', '{{base.main_user.name}}', '-c', '/usr/bin/apm install language-systemd']},
  {action = 'run', bin = 'runuser', args = ['-l', '{{base.main_user.name}}', '-c', '/usr/bin/apm install go-plus']},
  {action = 'run', bin = 'runuser', args = ['-l', '{{base.main_user.name}}', '-c', '/usr/bin/apm install atom-beautify']},
  {action = 'run', bin = 'runuser', args = ['-l', '{{base.main_user.name}}', '-c', '/usr/bin/apm install language-ccr']},
  {action = 'run', bin = 'runuser', args = ['-l', '{{base.main_user.name}}', '-c', '/usr/bin/apm install language-hcl']},
  {action = 'run', bin = 'runuser', args = ['-l', '{{base.main_user.name}}', '-c', '/usr/bin/apm install language-proto']},
]
